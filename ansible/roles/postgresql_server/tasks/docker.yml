---
- set_fact:
    postgresql_server_docker_volumes:
      - "{{ postgresql_server_data_dir }}:{{ postgresql_server_data_dir }}"
  when: postgresql_server_data_dir is not none

- name: create the custom data directory
  file:
    path: "{{ postgresql_server_data_dir }}"
    state: directory
  when: postgresql_server_data_dir is not none

- name: create the Docker container
  docker:
    name: cyb-postgresql
    image: postgres:{{ postgresql_server_version }}
    pull: always
    ports: "{{ postgresql_server_port }}:5432"
    env:
      PGDATA: "{{ postgresql_server_data_dir or omit }}"
      POSTGRES_PASSWORD: "{{ postgresql_server_root_password | require_value }}"
      POSTGRES_USER: "{{ postgresql_server_root_user }}"
    volumes: "{{ postgresql_server_docker_volumes }}"
    restart_policy: always
    state: reloaded
  no_log: yes
