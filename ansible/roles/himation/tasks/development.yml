---
- name: fetch the source code
  git:
    accept_hostkey: yes
    clone: yes
    dest: "{{ himation_source_dir }}"
    repo: git@github.com:justinlocsei/himation.git
    update: yes
    version: "{{ himation_git_branch }}"

- name: create a vendor directory
  file:
    path: "{{ himation_source_dir }}/vendor"
    mode: 0755
    state: directory
  register: himation_vendor_dir

- name: install Ruby dependencies
  bundler:
    chdir: "{{ himation_source_dir }}"
    gem_path: "{{ himation_vendor_dir.path }}/bundle"
    deployment_mode: no
    state: present

- name: install Node dependencies
  npm:
    path: "{{ himation_source_dir }}"
    production: no
    state: present

- name: link source directories through npm
  command: npm run link
  args:
    chdir: "{{ himation_source_dir }}"

- name: create the configuration file
  template:
    src: settings-development.json.j2
    dest: "{{ himation_source_dir }}/config/settings.json"
    mode: 0644
