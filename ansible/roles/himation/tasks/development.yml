---
- name: fetch the source code
  git:
    accept_hostkey: yes
    clone: yes
    dest: "{{ himation_source_dir }}"
    repo: git@github.com:justinlocsei/himation.git
    update: yes
    version: "{{ himation_git_branch }}"

- name: install Ruby dependencies
  bundler:
    gemfile: "{{ himation_source_dir }}/Gemfile"
    deployment_mode: no
    user_install: no
    state: present

- name: install Node dependencies
  npm:
    path: "{{ himation_source_dir }}"
    production: no
    state: present

- name: link source directories through npm
  command: npm run link
  args:
    chdir: "{{ himation_source_dir }}"

- name: create the configuration file
  template:
    src: settings-development.json.j2
    dest: "{{ himation_source_dir }}/config/settings.json"
    mode: 0644
