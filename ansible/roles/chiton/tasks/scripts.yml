---
- name: create the database scripts
  template:
    src: "scripts/{{ item }}.j2"
    dest: "{{ chiton_scripts_dir }}/{{ item }}"
    owner: "{{ chiton_user }}"
    group: "{{ chiton_group }}"
    mode: 0700
  with_items:
    - db-dump
    - db-restore

- name: create development scripts
  template:
    src: "scripts/{{ item }}.j2"
    dest: "{{ chiton_scripts_dir }}/{{ item }}"
    owner: "{{ chiton_user }}"
    group: "{{ chiton_group }}"
    mode: 0755
  with_items:
    - develop
    - test
  when: chiton_allow_development

- name: create an init script for chiton
  template:
    src: init.j2
    dest: /etc/init.d/chiton
    owner: root
    group: root
    mode: 0755
  when: chiton_daemonize

- name: run chiton at boot
  service:
    name: chiton
    enabled: yes
  when: chiton_daemonize
